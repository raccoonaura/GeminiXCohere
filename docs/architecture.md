# 系統架構
## 模型呼叫流程
1. 使用者輸入prompt
2. 並行呼叫Gemini及Cohere API
3. 先顯示Gemini的原始回答
4. 將兩份回答丟回Gemini → 生成整合版
5. 將整合版覆蓋原本的答案，顯示在介面
## 記憶系統
- 使用列表儲存過往輪次(user / model 對話)
- 每次發問時將歷史對話一併送出，形成多回合上下文
## Key 輸入機制
- 使用者在本地輸入，不會以任何形式儲存
## 並行呼叫
- loading，fallback
## Reasoning / Thinking
- 系統會偵測問題前是否有prefix "@"
- 有 → 同時開啟兩個模型的思考功能 並以文字提示思考已開啟
- 無 → 不開啟思考功能 生成較快且節省token
## 檔案檢索
- 系統會偵測問題前是否有prefix "$"
- 有 → 進行檔案選擇 單次可選擇圖片及文檔各一
- 無 → 不開啟檔案檢索功能
## 圖片讀取
1. 檔案讀取
2. 根據各模型支援的圖片類型選擇回覆的模型
3. 將圖片的base64 URI插入prompt
## 文檔 RAG 流程
1. 檔案讀取
2. 檔案類型轉換
3. 文件切塊
4. Embedding生成
5. Top-k檢索
6. 對Top-k的部分進行rerank
7. 將最相關的檢索結果插入系統指示
## Text-to-SQL RAG 流程
1. 檔案讀取
2. 內容轉換為統一格式
3. 儲存為database
4. 讓Gemini使用函式呼叫來尋找答案